<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DEAD WEEKEND | CITY SURVIVAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Rajdhani:wght@700&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Rajdhani', sans-serif; }
        canvas { display: block; }
        #ui { position: fixed; inset: 0; pointer-events: none; z-index: 100; }
        #hud { position: absolute; bottom: 30px; left: 30px; color: #ff4444; }
        .hp-box { width: 300px; height: 15px; background: rgba(255,0,0,0.1); border: 2px solid #ff4444; margin-top: 5px; box-shadow: 0 0 10px #ff0000; }
        #hp-fill { width: 100%; height: 100%; background: #ff4444; transition: 0.3s; }
        #mission { position: absolute; top: 30px; left: 30px; color: #fff; text-transform: uppercase; letter-spacing: 2px; }
        #objective { color: #ffff00; font-size: 1.2rem; }
        #title-card { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 200; transition: 1s; }
        h1 { font-family: 'Creepster', cursive; font-size: 5rem; color: #ff0000; margin: 0; text-shadow: 0 0 20px #000; }
        .btn { background: #ff0000; border: none; padding: 15px 40px; color: white; cursor: pointer; font-family: 'Rajdhani'; font-weight: bold; font-size: 1.5rem; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="title-card">
        <h1>DEAD WEEKEND</h1>
        <p style="color: #666; letter-spacing: 5px;">SURVIVE THE CITY â€¢ SAVE ANNA</p>
        <button class="btn" onclick="startGame()">ENTER THE QUARANTINE</button>
    </div>

    <div id="ui">
        <div id="mission">
            MISSION: <span id="objective">Locate Anna in the City Square</span>
        </div>
        <div id="hud">
            SURVIVOR VITALS
            <div class="hp-box"><div id="hp-fill"></div></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, clock;
        let zombies = [], bullets = [], buildings = [];
        let isPlaying = false, health = 100, annaSaved = false;
        let anna;
        const keys = {};

        function startGame() {
            document.getElementById('title-card').style.opacity = '0';
            setTimeout(() => document.getElementById('title-card').style.display = 'none', 1000);
            isPlaying = true;
            document.body.requestPointerLock();
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x110a0a);
            scene.fog = new THREE.FogExp2(0x110a0a, 0.04);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            clock = new THREE.Clock();

            // Street Lights (Atmospheric)
            const light = new THREE.PointLight(0xffaa00, 2, 50);
            light.position.set(0, 10, 0);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0xffffff, 0.2));

            createCity();
            createCharacters();

            window.onkeydown = (e) => keys[e.code] = true;
            window.onkeyup = (e) => keys[e.code] = false;
            window.onmousedown = shoot;

            animate();
        }

        function createCity() {
            // Dark Asphalt
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshStandardMaterial({color: 0x111111}));
            ground.rotation.x = -Math.PI/2;
            ground.receiveShadow = true;
            scene.add(ground);

            // 3D Hybrid Buildings
            for(let i=0; i<20; i++) {
                const h = 10 + Math.random() * 20;
                const b = new THREE.Mesh(new THREE.BoxGeometry(10, h, 10), new THREE.MeshStandardMaterial({color: 0x222222}));
                b.position.set(Math.random()*200-100, h/2, Math.random()*200-100);
                if(b.position.length() < 15) b.position.x += 20; // Clear spawn
                scene.add(b);
                buildings.push(b);
            }
        }

        function createCharacters() {
            // Player (Invisible placeholder for camera)
            player = new THREE.Group();
            player.position.set(0, 1.8, 10);
            scene.add(player);

            // ANNA (The Target)
            const annaMat = new THREE.SpriteMaterial({color: 0xffcc00}); // Placeholder for high-res sprite
            anna = new THREE.Sprite(annaMat);
            anna.scale.set(1.5, 2, 1);
            anna.position.set(Math.random()*40-20, 1, -40);
            scene.add(anna);

            // ZOMBIES
            for(let i=0; i<15; i++) {
                spawnZombie();
            }
        }

        function spawnZombie() {
            const zMat = new THREE.SpriteMaterial({color: 0x00ff00});
            const z = new THREE.Sprite(zMat);
            z.scale.set(1.5, 2, 1);
            z.position.set(Math.random()*100-50, 1, Math.random()*100-100);
            scene.add(z);
            zombies.push({mesh: z, hp: 100, lastAttack: 0});
        }

        function shoot() {
            if(!isPlaying) return;
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: 0xffff00}));
            b.position.copy(player.position);
            const dir = new THREE.Vector3();
            camera.getWorldDirection(dir);
            bullets.push({mesh: b, dir: dir});
            scene.add(b);
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isPlaying) return;
            const delta = clock.getDelta();

            // Player Movement
            if(keys['KeyW']) player.translateZ(-0.2);
            if(keys['KeyS']) player.translateZ(0.2);
            if(keys['KeyA']) player.translateX(-0.2);
            if(keys['KeyD']) player.translateX(0.2);
            
            // Mouse Look
            document.addEventListener('mousemove', (e) => {
                if(isPlaying) {
                    player.rotation.y -= e.movementX * 0.002;
                    camera.rotation.x -= e.movementY * 0.002;
                    camera.rotation.x = Math.max(-1, Math.min(1, camera.rotation.x));
                }
            });
            camera.position.copy(player.position);
            camera.rotation.y = player.rotation.y;

            // Mission Logic
            if(player.position.distanceTo(anna.position) < 3 && !annaSaved) {
                annaSaved = true;
                document.getElementById('objective').innerText = "Clear the horde! Escort Anna to Exit";
                anna.parent = player; // Anna follows player
                anna.position.set(1, -0.5, -2);
            }

            // Zombie AI (Hybrid Behavior)
            zombies.forEach((z, i) => {
                const dist = z.mesh.position.distanceTo(player.position);
                
                // Real-time chase
                const chaseSpeed = (health < 40) ? 0.08 : 0.03; // Zombies smell fear!
                const dir = new THREE.Vector3().subVectors(player.position, z.mesh.position).normalize();
                z.mesh.position.addScaledVector(dir, chaseSpeed);

                if(dist < 2 && Date.now() - z.lastAttack > 1500) {
                    health -= 10;
                    document.getElementById('hp-fill').style.width = health + "%";
                    z.lastAttack = Date.now();
                    if(health <= 0) location.reload();
                }
            });

            // Bullets
            bullets.forEach((b, bi) => {
                b.mesh.position.addScaledVector(b.dir, 1);
                zombies.forEach((z, zi) => {
                    if(b.mesh.position.distanceTo(z.mesh.position) < 1.5) {
                        z.hp -= 50;
                        scene.remove(b.mesh); bullets.splice(bi, 1);
                        if(z.hp <= 0) {
                            scene.remove(z.mesh); zombies.splice(zi, 1);
                            spawnZombie(); // Keep the weekend busy!
                        }
                    }
                });
            });

            renderer.render(scene, camera);
        }
        init();
    </script>
</body>
</html>
