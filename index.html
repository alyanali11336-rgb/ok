<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DEAD WEEKEND | OPERATION ANNA</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #050505; color: white; font-family: 'Share Tech Mono', monospace; }
        canvas { display: block; }
        
        /* Tactical HUD */
        #hud { position: fixed; inset: 0; pointer-events: none; z-index: 10; border: 20px solid rgba(255, 255, 255, 0.05); }
        #vignette { position: absolute; inset: 0; background: radial-gradient(circle, transparent 50%, rgba(0,0,0,0.8) 100%); }
        
        #comms-window { position: absolute; top: 40px; right: 40px; width: 300px; background: rgba(0, 20, 0, 0.8); border-left: 4px solid #00ff00; padding: 15px; display: none; }
        #commander-name { color: #00ff00; font-weight: bold; font-size: 0.8rem; margin-bottom: 5px; }
        #comms-text { font-size: 0.9rem; color: #fff; line-height: 1.2; }

        #stats { position: absolute; bottom: 40px; left: 40px; }
        .bar-container { width: 250px; height: 10px; background: rgba(255,255,255,0.1); border: 1px solid #444; margin: 10px 0; }
        #hp-fill { width: 100%; height: 100%; background: #00ffcc; transition: 0.3s; box-shadow: 0 0 10px #00ffcc; }
        
        #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; border: 1px solid rgba(0, 255, 204, 0.5); transform: translate(-50%, -50%); border-radius: 50%; }
        
        #intro { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 2s; }
        h1 { font-family: 'Orbitron'; font-size: 3rem; color: #00ffcc; letter-spacing: 10px; margin: 0; }
    </style>
</head>
<body>

    <div id="intro">
        <h1>DEAD WEEKEND</h1>
        <p style="letter-spacing: 5px; color: #888;">FBI SPECIAL OPERATIONS ‚Ä¢ SECTOR 4</p>
        <button onclick="startMission()" style="background:none; border: 1px solid #00ffcc; color:#00ffcc; padding:15px 40px; cursor:pointer; margin-top:30px; font-family:'Orbitron';">INITIATE DEPLOYMENT</button>
    </div>

    <div id="hud">
        <div id="vignette"></div>
        <div id="crosshair"></div>
        <div id="comms-window">
            <div id="commander-name">üõ∞Ô∏è COMMANDER MILLER [FBI]</div>
            <div id="comms-text">"Agent, the virus hit the city hard. Find Dr. Anna at the safe house. Move!"</div>
        </div>
        <div id="stats">
            AGENT VITALS
            <div class="bar-container"><div id="hp-fill"></div></div>
            AMMO: <span id="ammo">15 / 15</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, clock, flash;
        let zombies = [], bullets = [], walls = [];
        let health = 100, isPlaying = false, ammo = 15;
        let annaFound = false;

        function startMission() {
            document.getElementById('intro').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro').style.display = 'none';
                isPlaying = true;
                playComms("Agent, Dr. Anna is trapped in the center of the block. Rescue her and eliminate any bio-threats.");
            }, 2000);
            document.body.requestPointerLock();
        }

        function playComms(text) {
            const win = document.getElementById('comms-window');
            const txt = document.getElementById('comms-text');
            win.style.display = 'block';
            txt.innerText = "";
            let i = 0;
            const interval = setInterval(() => {
                txt.innerText += text[i];
                i++;
                if (i >= text.length) clearInterval(interval);
            }, 300);
            setTimeout(() => { win.style.display = 'none'; }, 6000);
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020202);
            scene.fog = new THREE.FogExp2(0x020202, 0.05);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            clock = new THREE.Clock();

            // Lighting
            const sun = new THREE.DirectionalLight(0x4444ff, 0.5); // Moonlight
            sun.position.set(10, 20, 10);
            scene.add(sun, new THREE.AmbientLight(0xffffff, 0.05));

            createCity();
            createPlayer();
            spawnAnna();
            for(let i=0; i<10; i++) spawnZombie();

            window.onkeydown = (e) => keys[e.code] = true;
            window.onkeyup = (e) => keys[e.code] = false;
            window.onmousedown = shoot;
            document.addEventListener('mousemove', onMove);

            animate();
        }

        const keys = {};
        function onMove(e) {
            if(!isPlaying) return;
            player.rotation.y -= e.movementX * 0.002;
            camera.rotation.x -= e.movementY * 0.002;
            camera.rotation.x = Math.max(-1.4, Math.min(1.4, camera.rotation.x));
        }

        function createPlayer() {
            player = new THREE.Group();
            player.position.set(0, 1.8, 20);
            scene.add(player);

            // Gun model
            const g = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 0.5), new THREE.MeshStandardMaterial({color:0x111111}));
            flash = new THREE.PointLight(0xffaa00, 0, 5);
            g.add(body, flash);
            g.position.set(0.3, -0.3, -0.5);
            camera.add(g);
            scene.add(camera);
        }

        function createCity() {
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshStandardMaterial({color: 0x111111}));
            ground.rotation.x = -Math.PI/2; ground.receiveShadow = true;
            scene.add(ground);

            // Buildings
            for(let i=0; i<30; i++) {
                const h = 5 + Math.random()*20;
                const b = new THREE.Mesh(new THREE.BoxGeometry(10, h, 10), new THREE.MeshStandardMaterial({color: 0x222222}));
                b.position.set(Math.random()*200-100, h/2, Math.random()*200-100);
                if(b.position.length() < 15) b.position.z -= 20;
                scene.add(b);
                walls.push(b);
            }
        }

        function spawnAnna() {
            const geo = new THREE.CylinderGeometry(0.4, 0.4, 1.8);
            const mat = new THREE.MeshStandardMaterial({color: 0xff00ff, emissive: 0x220022});
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(0, 0.9, -40);
            mesh.name = "Anna";
            scene.add(mesh);
        }

        function spawnZombie() {
            const zGeo = new THREE.BoxGeometry(0.8, 1.8, 0.8);
            const zMat = new THREE.MeshStandardMaterial({color: 0x223322});
            const z = new THREE.Mesh(zGeo, zMat);
            z.position.set(Math.random()*80-40, 0.9, Math.random()*80-80);
            scene.add(z);
            zombies.push({mesh: z, hp: 100, lastHit: 0});
        }

        function shoot() {
            if(!isPlaying || ammo <= 0) return;
            ammo--;
            document.getElementById('ammo').innerText = `${ammo} / 15`;
            flash.intensity = 10;
            setTimeout(() => flash.intensity = 0, 50);

            const b = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: 0xffff00}));
            b.position.copy(player.position);
            const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
            bullets.push({mesh: b, dir: dir});
            scene.add(b);
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isPlaying) return;
            const delta = clock.getDelta();

            // Movement
            const oldPos = player.position.clone();
            if(keys['KeyW']) player.translateZ(-0.15);
            if(keys['KeyS']) player.translateZ(0.15);
            if(keys['KeyA']) player.translateX(-0.15);
            if(keys['KeyD']) player.translateX(0.15);
            walls.forEach(w => { if(player.position.distanceTo(w.position) < 6) player.position.copy(oldPos); });

            camera.position.copy(player.position);
            camera.rotation.y = player.rotation.y;

            // Mission Logic
            const anna = scene.getObjectByName("Anna");
            if(anna && player.position.distanceTo(anna.position) < 3 && !annaFound) {
                annaFound = true;
                playComms("VIP secured! Commander, I have Dr. Anna. Requesting extraction at the North Gate!");
                scene.remove(anna);
            }

            // Zombie AI
            zombies.forEach((z, i) => {
                const dist = z.mesh.position.distanceTo(player.position);
                const speed = (health < 40) ? 0.08 : 0.03;
                z.mesh.lookAt(player.position.x, 0.9, player.position.z);
                z.mesh.translateZ(speed);

                if(dist < 2 && Date.now() - z.lastHit > 1500) {
                    health -= 15;
                    document.getElementById('hp-fill').style.width = health + "%";
                    z.lastHit = Date.now();
                    if(health < 30) playComms("Agent, your vitals are dropping! Get out of there!");
                    if(health <= 0) location.reload();
                }
            });

            // Bullets
            bullets.forEach((b, bi) => {
                b.mesh.position.addScaledVector(b.dir, 1.5);
                zombies.forEach((z, zi) => {
                    if(b.mesh.position.distanceTo(z.mesh.position) < 1.5) {
                        z.hp -= 50; scene.remove(b.mesh); bullets.splice(bi, 1);
                        if(z.hp <= 0) { scene.remove(z.mesh); zombies.splice(zi, 1); spawnZombie(); }
                    }
                });
            });

            renderer.render(scene, camera);
        }
        init();
    </script>
</body>
</html>
