<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Frontline | Tactical Co-op</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Inter', sans-serif; }
        #ui { position: absolute; inset: 0; pointer-events: none; }
        
        /* Tactical HUD */
        #comms {
            position: absolute; top: 30px; left: 30px; background: rgba(0,0,0,0.85);
            padding: 15px; border-left: 3px solid #00ff00; color: white; width: 300px;
            font-size: 13px; backdrop-filter: blur(10px);
        }
        #squad-status {
            position: absolute; bottom: 40px; right: 40px; color: white;
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 4px;
        }
        .member { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .status-dot { width: 8px; height: 8px; background: #00ff00; border-radius: 50%; }

        #crosshair { position: absolute; top: 50%; left: 50%; width: 6px; height: 6px; background: rgba(255,255,255,0.8); border-radius: 50%; transform: translate(-50%, -50%); }
        
        #overlay { position: absolute; inset: 0; background: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        button { padding: 20px 60px; background: #000; color: #fff; border: none; font-weight: 900; cursor: pointer; letter-spacing: 5px; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="font-size: 5vw; margin: 0; letter-spacing: -2px;">SQUADRON</h1>
        <p style="color: #888; margin-bottom: 30px;">CO-OP TACTICAL AI INITIALIZED</p>
        <button onclick="controls.lock()">START PATROL</button>
    </div>

    <div id="ui">
        <div id="comms"><strong>HQ:</strong> "Ghost is linked to your comms. Move out."</div>
        
        <div id="squad-status">
            <div class="member"><div class="status-dot"></div> <span>YOU (LEADER)</span></div>
            <div class="member"><div class="status-dot"></div> <span>GHOST (CO-OP AI)</span></div>
        </div>

        <div id="crosshair"></div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- ENGINE ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xdcefff);
        scene.fog = new THREE.FogExp2(0xdcefff, 0.012);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        window.controls = new PointerLockControls(camera, document.body);

        // --- LIGHTS ---
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const sun = new THREE.DirectionalLight(0xffffff, 2.5);
        sun.position.set(50, 100, 50);
        sun.castShadow = true;
        scene.add(sun);

        // --- WORLD ---
        const ground = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshStandardMaterial({color: 0x3a4d23}));
        ground.rotation.x = -Math.PI/2; ground.receiveShadow = true;
        scene.add(ground);

        // --- CHARACTER FACTORY ---
        function createSoldier(bodyCol, skinCol, nameTag) {
            const group = new THREE.Group();
            const mat = new THREE.MeshStandardMaterial({ color: bodyCol });
            
            const torso = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.8, 0.4), mat);
            torso.position.y = 1.2;
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.3, 0.3), new THREE.MeshStandardMaterial({color: skinCol}));
            head.position.y = 1.8;

            const legL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.8, 0.2), mat);
            legL.position.set(0.15, 0.4, 0);
            const legR = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.8, 0.2), mat);
            legR.position.set(-0.15, 0.4, 0);

            const gun = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.15, 0.8), new THREE.MeshStandardMaterial({color: 0x000}));
            gun.position.set(0.3, 1.3, 0.4);

            group.add(torso, head, legL, legR, gun);
            group.limbs = { legL, legR };
            return group;
        }

        // YOU & GHOST (The Friend)
        const playerModel = createSoldier(0x1a2e1a, 0xffdbac);
        const friend = createSoldier(0x1a1a2e, 0xffdbac); // Blueish tactical gear
        scene.add(playerModel, friend);

        const enemies = [];
        for(let i=0; i<12; i++) {
            const e = createSoldier(0x331111, 0xff0000);
            e.position.set((Math.random()-0.5)*150, 0, (Math.random()-0.5)*150);
            scene.add(e);
            enemies.push(e);
        }

        // --- ANIMATION & LOGIC ---
        let velocity = new THREE.Vector3();
        let keys = {};
        document.addEventListener('keydown', (e) => keys[e.code] = true);
        document.addEventListener('keyup', (e) => keys[e.code] = false);

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.01;

            if(controls.isLocked) {
                // Gravity & Jump
                velocity.y -= 0.3;
                camera.position.y += velocity.y * 0.016;
                if(camera.position.y < 1.7) { camera.position.y = 1.7; velocity.y = 0; }
                if(keys['Space'] && camera.position.y <= 1.7) velocity.y = 8;

                // Player Move
                let speed = keys['ShiftLeft'] ? 0.3 : 0.15;
                if(keys['KeyW']) controls.moveForward(speed);
                if(keys['KeyS']) controls.moveForward(-speed);
                if(keys['KeyA']) controls.moveRight(-speed);
                if(keys['KeyD']) controls.moveRight(speed);

                // Sync Player Model
                playerModel.position.copy(camera.position);
                playerModel.position.y -= 1.6;
                playerModel.rotation.y = camera.rotation.y;

                // CO-OP FRIEND AI (GHOST)
                const targetPos = playerModel.position.clone().add(new THREE.Vector3(2, 0, 2).applyQuaternion(playerModel.quaternion));
                friend.position.lerp(targetPos, 0.05);
                friend.lookAt(playerModel.position.x + 10, 0, playerModel.position.z + 10);

                // Limb Animation
                const isMoving = (keys['KeyW'] || keys['KeyS'] || keys['KeyA'] || keys['KeyD']);
                if(isMoving) {
                    playerModel.limbs.legL.rotation.x = Math.sin(time) * 0.5;
                    playerModel.limbs.legR.rotation.x = -Math.sin(time) * 0.5;
                    // Friend mimics your movement
                    friend.limbs.legL.rotation.x = Math.sin(time) * 0.5;
                    friend.limbs.legR.rotation.x = -Math.sin(time) * 0.5;
                }

                // Camera Shoulder Offset
                const camOffset = new THREE.Vector3(1.0, 0.5, 3.5).applyQuaternion(camera.quaternion);
                camera.position.add(camOffset);

                // Enemy AI
                enemies.forEach(en => {
                    if(en.position.distanceTo(playerModel.position) < 50) {
                        en.lookAt(playerModel.position);
                        en.translateZ(0.06);
                        en.limbs.legL.rotation.x = Math.sin(time) * 0.5;
                        en.limbs.legR.rotation.x = -Math.sin(time) * 0.5;
                    }
                });
            }
            renderer.render(scene, camera);
        }
        animate();

        controls.addEventListener('lock', () => document.getElementById('overlay').style.display='none');
        controls.addEventListener('unlock', () => document.getElementById('overlay').style.display='flex');
    </script>
</body>
</html>
