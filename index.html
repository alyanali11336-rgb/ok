<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VANGUARD: APEX OPS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #050505; font-family: 'Rajdhani', sans-serif; }
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }
        
        #vignette { position: fixed; width: 100%; height: 100%; box-shadow: inset 0 0 200px rgba(0,0,0,0.9); pointer-events: none; z-index: 10; }
        
        #hud { position: absolute; bottom: 30px; left: 30px; z-index: 50; display: none; color: #fff; }
        .bar-container { width: 250px; height: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(0,255,204,0.3); margin: 5px 0; }
        #hp-fill { width: 100%; height: 100%; background: #00ffcc; box-shadow: 0 0 15px #00ffcc; transition: 0.3s; }
        
        #weapon-info { position: absolute; bottom: 30px; right: 30px; z-index: 50; display: none; color: #00ffcc; text-align: right; font-family: 'Orbitron'; }
        #ammo-display { font-size: 2rem; margin: 0; }

        #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; border: 1px solid #00ffcc; border-radius: 50%; transform: translate(-50%, -50%); z-index: 50; display: none; }
        #ui-layer { position: absolute; z-index: 100; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; text-align: center; }
        .btn-deploy { background: #00ffcc; border: none; padding: 15px 50px; font-size: 1.5rem; cursor: pointer; font-family: 'Orbitron'; font-weight: bold; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); }
    </style>
</head>
<body>

    <div id="vignette"></div>
    <div id="crosshair"></div>
    
    <div id="hud">
        VITAL SIGNS
        <div class="bar-container"><div id="hp-fill"></div></div>
        <div id="weapon-name" style="color:#00ffcc; font-family: Orbitron;">ASSAULT RIFLE</div>
    </div>

    <div id="weapon-info">
        AMMO
        <p id="ammo-display">30 / ∞</p>
    </div>

    <div id="ui-layer">
        <div>
            <h1 style="color:#fff; font-family:Orbitron; font-size: 4rem; margin:0;">VANGUARD</h1>
            <p style="color:#00ffcc; letter-spacing: 10px; margin-bottom:30px;">ULTIMATE AAA WARZONE</p>
            <button class="btn-deploy" id="play-button">DEPLOY TO SECTOR</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>

    <script>
        let scene, camera, renderer, gun, clock;
        let isPlaying = false, health = 100, ammo = 30, activeGun = 1;
        let velocity = new THREE.Vector3();
        let bullets = [], enemyBullets = [], enemies = [], collidables = [], pickups = [];
        const keys = {};

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.FogExp2(0x87CEEB, 0.012);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.rotation.order = 'YXZ';

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            clock = new THREE.Clock();

            const sun = new THREE.DirectionalLight(0xffffff, 2);
            sun.position.set(100, 200, 100);
            sun.castShadow = true;
            sun.shadow.mapSize.width = 2048;
            scene.add(sun);
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));

            createEnvironment();
            createGun();

            document.getElementById('play-button').onclick = () => document.body.requestPointerLock();
            document.addEventListener('pointerlockchange', () => {
                isPlaying = document.pointerLockElement === document.body;
                document.getElementById('ui-layer').style.display = isPlaying ? 'none' : 'flex';
                document.getElementById('hud').style.display = isPlaying ? 'block' : 'none';
                document.getElementById('weapon-info').style.display = isPlaying ? 'block' : 'none';
                document.getElementById('crosshair').style.display = isPlaying ? 'block' : 'none';
            });

            window.onkeydown = (e) => {
                keys[e.code] = true;
                if(e.code === 'Digit1') switchGun(1);
                if(e.code === 'Digit2') switchGun(2);
            };
            window.onkeyup = (e) => keys[e.code] = false;
            window.onmousemove = (e) => {
                if(isPlaying) {
                    camera.rotation.y -= e.movementX * 0.002;
                    camera.rotation.x -= e.movementY * 0.002;
                    camera.rotation.x = Math.max(-1.5, Math.min(1.5, camera.rotation.x));
                }
            };
            window.onmousedown = () => { if(isPlaying && ammo > 0) shoot(); };

            animate();
        }

        function switchGun(type) {
            activeGun = type;
            document.getElementById('weapon-name').innerText = type === 1 ? "ASSAULT RIFLE" : "HEAVY SNIPER";
            gun.scale.set(type === 1 ? 1 : 1.5, 1, 1);
            ammo = type === 1 ? 30 : 5;
            updateAmmoUI();
        }

        function updateAmmoUI() {
            document.getElementById('ammo-display').innerText = `${ammo} / ∞`;
        }

        function createGun() {
            gun = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.2, 0.8), new THREE.MeshStandardMaterial({color: 0x111111}));
            const barrel = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 0.6), new THREE.MeshStandardMaterial({color: 0x000000}));
            barrel.rotation.x = Math.PI/2; barrel.position.z = -0.5;
            gun.add(body, barrel);
            gun.position.set(0.3, -0.3, -0.6);
            camera.add(gun);
            scene.add(camera);
        }

        function createHumanoid(x, z) {
            const bot = new THREE.Group();
            const mat = new THREE.MeshStandardMaterial({color: 0x222222});
            const torso = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.9, 0.4), mat);
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.3, 0.3), mat);
            head.position.y = 0.7;
            const armL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.6, 0.2), mat);
            armL.position.set(-0.4, 0.1, 0);
            bot.add(torso, head, armL);
            bot.position.set(x, 1.5, z);
            scene.add(bot);
            return {mesh: bot, hp: 100, state: 'attack'};
        }

        function createEnvironment() {
            // Ground
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(2000, 2000), new THREE.MeshStandardMaterial({color: 0x3d443a}));
            floor.rotation.x = -Math.PI/2; floor.receiveShadow = true;
            scene.add(floor);

            // Mountains
            for(let i=0; i<6; i++) {
                const mt = new THREE.Mesh(new THREE.ConeGeometry(50, 80, 4), new THREE.MeshStandardMaterial({color: 0x444444}));
                const angle = (i/6) * Math.PI*2;
                mt.position.set(Math.cos(angle)*150, 40, Math.sin(angle)*150);
                scene.add(mt); collidables.push(mt);
            }

            // Fixed House
            const house = new THREE.Group();
            const wallMat = new THREE.MeshStandardMaterial({color: 0x555555});
            const buildWall = (w, h, d, x, y, z) => {
                const m = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), wallMat);
                m.position.set(x, y, z); house.add(m); collidables.push(m);
            };
            buildWall(10, 6, 0.5, 0, 3, -5); buildWall(0.5, 6, 10, -5, 3, 0);
            buildWall(0.5, 6, 10, 5, 3, 0); buildWall(4, 6, 0.5, -3, 3, 5); buildWall(4, 6, 0.5, 3, 3, 5);
            const roof = new THREE.Mesh(new THREE.BoxGeometry(11, 0.5, 11), new THREE.MeshStandardMaterial({color: 0x222222}));
            roof.position.y = 6; house.add(roof); collidables.push(roof);
            scene.add(house); house.position.set(0,0,-30);

            // Trees and Boxes
            for(let i=0; i<40; i++) {
                const x = Math.random()*150-75, z = Math.random()*150-75;
                if(Math.abs(x)<15 && Math.abs(z+30)<15) continue;
                const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 8), new THREE.MeshStandardMaterial({color: 0x4b3621}));
                trunk.position.set(x, 4, z); scene.add(trunk); collidables.push(trunk);
                const leaves = new THREE.Mesh(new THREE.SphereGeometry(3, 8, 8), new THREE.MeshStandardMaterial({color: 0x1b3022}));
                leaves.position.set(x, 8, z); scene.add(leaves);
            }

            // Medkits (Green) and Ammo (Blue)
            for(let i=0; i<10; i++) {
                const isMed = i % 2 === 0;
                const p = new THREE.Mesh(new THREE.BoxGeometry(1, 0.5, 1), new THREE.MeshStandardMaterial({color: isMed ? 0x00ff00 : 0x0000ff, emissive: isMed ? 0x00ff00 : 0x0000ff}));
                p.position.set(Math.random()*100-50, 0.25, Math.random()*100-50);
                scene.add(p);
                pickups.push({mesh: p, type: isMed ? 'health' : 'ammo'});
            }

            // Humanoid Enemies
            for(let i=0; i<10; i++) {
                enemies.push(createHumanoid(Math.random()*160-80, Math.random()*160-80));
            }
        }

        function shoot() {
            ammo--;
            updateAmmoUI();
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: 0x00ffcc}));
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
            bullets.push({mesh: b, dir: dir});
            scene.add(b);
            gun.position.z += 0.15;
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isPlaying) return;

            const delta = clock.getDelta();
            const time = Date.now();

            // AAA Gravity and Movement
            velocity.y -= 30 * delta; // Gravity
            let speed = keys['ShiftLeft'] ? 0.3 : 0.15;
            const oldPos = camera.position.clone();

            if(keys['KeyW']) camera.translateZ(-speed);
            if(keys['KeyS']) camera.translateZ(speed);
            if(keys['KeyA']) camera.translateX(-speed);
            if(keys['KeyD']) camera.translateX(speed);

            camera.position.y += velocity.y * delta;
            if(camera.position.y < 1.8) { camera.position.y = 1.8; velocity.y = 0; }
            if(keys['Space'] && camera.position.y <= 1.81) velocity.y = 10;

            // Collision
            collidables.forEach(c => { if(camera.position.distanceTo(c.position) < 3) camera.position.copy(oldPos); });

            // Pickups
            pickups.forEach((p, i) => {
                if(camera.position.distanceTo(p.mesh.position) < 2) {
                    if(p.type === 'health') health = Math.min(100, health + 40);
                    else ammo += 30;
                    document.getElementById('hp-fill').style.width = health + "%";
                    updateAmmoUI();
                    scene.remove(p.mesh); pickups.splice(i, 1);
                }
            });

            // Enemy AI Intelligence
            enemies.forEach((en, i) => {
                const dist = en.mesh.position.distanceTo(camera.position);
                
                if(en.hp < 40) { // Flee logic
                    en.state = 'flee';
                    const runDir = new THREE.Vector3().subVectors(en.mesh.position, camera.position).normalize();
                    en.mesh.position.addScaledVector(runDir, 0.1);
                } else { // Attack logic
                    en.mesh.lookAt(camera.position);
                    if(dist < 50 && time - (en.lastShot || 0) > 2000) {
                        const eb = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshBasicMaterial({color: 0xff0000}));
                        eb.position.copy(en.mesh.position);
                        const eDir = new THREE.Vector3().subVectors(camera.position, en.mesh.position).normalize();
                        enemyBullets.push({mesh: eb, dir: eDir});
                        scene.add(eb);
                        en.lastShot = time;
                    }
                }
            });

            // Bullet Logic
            bullets.forEach((b, i) => {
                b.mesh.position.addScaledVector(b.dir, 2);
                enemies.forEach((en, ei) => {
                    if(b.mesh.position.distanceTo(en.mesh.position) < 2) {
                        en.hp -= activeGun === 1 ? 25 : 100;
                        if(en.hp <= 0) { scene.remove(en.mesh); enemies.splice(ei, 1); }
                        scene.remove(b.mesh); bullets.splice(i, 1);
                    }
                });
            });

            enemyBullets.forEach((eb, i) => {
                eb.mesh.position.addScaledVector(eb.dir, 0.8);
                if(eb.mesh.position.distanceTo(camera.position) < 1.5) {
                    health -= 10;
                    document.getElementById('hp-fill').style.width = health + "%";
                    scene.remove(eb.mesh); enemyBullets.splice(i, 1);
                    if(health <= 0) location.reload();
                }
            });

            gun.position.z += (-0.6 - gun.position.z) * 0.1;
            renderer.render(scene, camera);
        }
        window.onload = init;
    </script>
</body>
</html>
