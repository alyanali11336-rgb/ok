<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VANGUARD PRO | AAA DAYLIGHT OPS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #87CEEB; font-family: 'Rajdhani', sans-serif; }
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }

        /* HUD & UI */
        #ui-layer {
            position: absolute; z-index: 100; width: 100%; height: 100%;
            background: rgba(0,0,0,0.3); display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .lobby-card {
            background: rgba(0, 0, 0, 0.9); padding: 50px; border-left: 5px solid #00ffcc;
            text-align: center; backdrop-filter: blur(15px); box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        h1 { font-family: 'Orbitron'; font-size: 3.5rem; margin: 0; color: #fff; letter-spacing: 12px; }
        .btn-deploy {
            background: #00ffcc; border: none; color: #000; padding: 15px 60px; font-size: 1.5rem; 
            font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 20px;
        }

        /* IN-GAME HUD */
        #game-hud {
            position: absolute; top: 20px; left: 20px; z-index: 50; display: none;
            color: #00ffcc; font-size: 1.2rem; text-shadow: 2px 2px #000;
        }
        #crosshair {
            position: fixed; top: 50%; left: 50%; width: 20px; height: 20px;
            border: 1px solid rgba(0,255,204,0.8); border-radius: 50%;
            transform: translate(-50%, -50%); z-index: 50; display: none; pointer-events: none;
        }
        #crosshair::after { content: ''; position: absolute; top: 50%; left: 50%; width: 2px; height: 2px; background: #00ffcc; transform: translate(-50%, -50%); }
    </style>
</head>
<body>

    <div id="crosshair"></div>
    <div id="game-hud">
        PLAYERS IN SESSION: <span id="player-count">32</span><br>
        ENEMIES DETECTED: <span id="enemy-count">0</span><br>
        SECTOR: NORTHERN FOREST (BETA)
    </div>

    <div id="ui-layer">
        <div class="lobby-card">
            <h1>VANGUARD</h1>
            <p style="color: #888;">TRIPLE-A GRAPHICS // REAL-TIME LIGHTING</p>
            <button class="btn-deploy" id="play-button">DEPLOY TO MAP</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>

    <script>
        let scene, camera, renderer, clock, gun;
        let isPlaying = false;
        let player = { height: 1.7, velocityY: 0, isJumping: false };
        let bullets = [], enemies = [];
        const keys = {};

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x90caef);
            scene.fog = new THREE.Fog(0x90caef, 5, 150);

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.rotation.order = 'YXZ';

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);

            clock = new THREE.Clock();

            // --- REALISTIC LIGHTING ---
            const sun = new THREE.DirectionalLight(0xffffff, 1.8);
            sun.position.set(40, 60, 20);
            sun.castShadow = true;
            sun.shadow.mapSize.width = 2048;
            sun.shadow.mapSize.height = 2048;
            scene.add(sun);
            scene.add(new THREE.AmbientLight(0xffffff, 0.4));

            createMap();
            createGun();

            // --- UI LOGIC ---
            const playBtn = document.getElementById('play-button');
            playBtn.addEventListener('click', () => document.body.requestPointerLock());

            document.addEventListener('pointerlockchange', () => {
                const locked = document.pointerLockElement === document.body;
                isPlaying = locked;
                document.getElementById('ui-layer').style.display = locked ? 'none' : 'flex';
                document.getElementById('game-hud').style.display = locked ? 'block' : 'none';
                document.getElementById('crosshair').style.display = locked ? 'block' : 'none';
            });

            window.addEventListener('keydown', (e) => keys[e.code] = true);
            window.addEventListener('keyup', (e) => keys[e.code] = false);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mousedown', () => { if(isPlaying) shoot(); });

            animate();
        }

        function createGun() {
            // AAA Realistic Rifle Mockup
            gun = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.08, 0.12, 0.6), new THREE.MeshStandardMaterial({color: 0x111111}));
            const barrel = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 0.5), new THREE.MeshStandardMaterial({color: 0x050505}));
            barrel.rotation.x = Math.PI / 2;
            barrel.position.z = -0.4;
            
            const scope = new THREE.Mesh(new THREE.BoxGeometry(0.04, 0.04, 0.15), new THREE.MeshStandardMaterial({color: 0x222222}));
            scope.position.y = 0.08;
            
            gun.add(body, barrel, scope);
            gun.position.set(0.3, -0.25, -0.5);
            camera.add(gun);
            scene.add(camera);
        }

        function createMap() {
            // Grass
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), new THREE.MeshStandardMaterial({ color: 0x4a7a3a }));
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // --- PROPER HOUSE INTERIOR ---
            const house = new THREE.Group();
            const mat = new THREE.MeshStandardMaterial({color: 0x777777, side: THREE.DoubleSide});
            
            // Walls
            const wallBack = new THREE.Mesh(new THREE.BoxGeometry(10, 5, 0.2), mat);
            wallBack.position.z = -5;
            
            const wallLeft = new THREE.Mesh(new THREE.BoxGeometry(0.2, 5, 10), mat);
            wallLeft.position.x = -5;
            
            const wallRight = new THREE.Mesh(new THREE.BoxGeometry(0.2, 5, 10), mat);
            wallRight.position.x = 5;

            const wallFront = new THREE.Group();
            const part1 = new THREE.Mesh(new THREE.BoxGeometry(4, 5, 0.2), mat);
            part1.position.x = -3;
            const part2 = new THREE.Mesh(new THREE.BoxGeometry(4, 5, 0.2), mat);
            part2.position.x = 3;
            wallFront.add(part1, part2); // Leaves a door gap in middle
            wallFront.position.z = 5;

            // Floor & Ceiling
            const hFloor = new THREE.Mesh(new THREE.BoxGeometry(10, 0.1, 10), new THREE.MeshStandardMaterial({color: 0x332211}));
            const hRoof = new THREE.Mesh(new THREE.BoxGeometry(11, 0.2, 11), mat);
            hRoof.position.y = 5;

            house.add(wallBack, wallLeft, wallRight, wallFront, hFloor, hRoof);
            house.position.set(0, 0.1, -20);
            scene.add(house);

            // Forest
            for(let i=0; i<80; i++) {
                const x = Math.random()*200-100, z = Math.random()*200-100;
                if(Math.abs(x) < 15 && Math.abs(z+20) < 15) continue;
                const tree = new THREE.Group();
                const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.5, 6), new THREE.MeshStandardMaterial({color: 0x3d2817}));
                const leaves = new THREE.Mesh(new THREE.ConeGeometry(2.5, 8, 8), new THREE.MeshStandardMaterial({color: 0x1e3a1a}));
                leaves.position.y = 5;
                tree.add(trunk, leaves); tree.position.set(x, 3, z); scene.add(tree);
            }

            // Enemies
            for(let i=0; i<10; i++) {
                const en = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 1), new THREE.MeshStandardMaterial({color: 0xff0033}));
                en.position.set(Math.random()*60-30, 1, Math.random()*60-30);
                scene.add(en); enemies.push(en);
            }
            document.getElementById('enemy-count').innerText = enemies.length;
        }

        function onMouseMove(e) {
            if (isPlaying) {
                camera.rotation.y -= e.movementX * 0.002;
                camera.rotation.x -= e.movementY * 0.002;
                camera.rotation.x = Math.max(-1.5, Math.min(1.5, camera.rotation.x));
            }
        }

        function shoot() {
            // AAA Recoil Effect
            gun.position.z += 0.05;
            
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.08), new THREE.MeshBasicMaterial({color: 0xffff00}));
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
            bullets.push({ mesh: b, dir: dir });
            scene.add(b);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (isPlaying) {
                const speed = keys['ShiftLeft'] ? 0.25 : 0.12;
                if(keys['KeyW']) camera.translateZ(-speed);
                if(keys['KeyS']) camera.translateZ(speed);
                if(keys['KeyA']) camera.translateX(-speed);
                if(keys['KeyD']) camera.translateX(speed);

                // Gravity & Jump
                if(keys['Space'] && !player.isJumping) { player.velocityY = 0.2; player.isJumping = true; }
                if(player.isJumping) {
                    camera.position.y += player.velocityY; player.velocityY -= 0.01;
                    if(camera.position.y <= player.height) { camera.position.y = player.height; player.isJumping = false; }
                } else { camera.position.y = player.height; }

                // Weapon Sway
                gun.position.z += (-0.5 - gun.position.z) * 0.1;
                gun.position.y = -0.25 + Math.sin(Date.now() * 0.005) * 0.01;

                bullets.forEach((b, i) => {
                    b.mesh.position.add(b.dir.clone().multiplyScalar(2.5));
                    enemies.forEach((en, ei) => {
                        if(b.mesh.position.distanceTo(en.position) < 1.5) {
                            scene.remove(en); enemies.splice(ei, 1);
                            document.getElementById('enemy-count').innerText = enemies.length;
                        }
                    });
                });
            }
            renderer.render(scene, camera);
        }

        window.onload = init;
        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
