<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VANGUARD 2D | TACTICAL DROP</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #2c3e50; font-family: 'Rajdhani', sans-serif; }
        canvas { display: block; cursor: crosshair; }
        
        #ui { position: fixed; inset: 0; pointer-events: none; z-index: 10; }
        #vignette { position: absolute; inset: 0; background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.6) 100%); }
        
        #hud { position: absolute; bottom: 30px; left: 30px; color: #fff; }
        .bar { width: 250px; height: 8px; background: rgba(255,255,255,0.1); border: 1px solid #fff; margin-top: 5px; }
        #hp-fill { width: 100%; height: 100%; background: #2ecc71; transition: 0.3s; }
        
        #altimeter { position: absolute; top: 30px; right: 30px; text-align: right; color: #f1c40f; font-family: 'Orbitron'; }
        #msg { position: absolute; top: 50%; width: 100%; text-align: center; color: #fff; font-family: 'Orbitron'; font-size: 2rem; opacity: 0; transition: 0.5s; }
    </style>
</head>
<body>

    <div id="ui">
        <div id="vignette"></div>
        <div id="msg">READY TO DEPLOY</div>
        <div id="altimeter">ALTITUDE: <span id="alt-val">100</span>m</div>
        <div id="hud">
            HEALTH
            <div class="bar"><div id="hp-fill"></div></div>
            <div id="status" style="font-size: 0.8rem; margin-top: 5px; letter-spacing: 2px;">STATUS: DESCENDING</div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let isLanded = false;
        let altitude = 100;
        let player = { x: 0, y: 0, angle: 0, hp: 100, size: 20 };
        let enemy = { x: 500, y: 500, angle: 0, hp: 100, state: 'stalk' };
        let bullets = [], enemyBullets = [], trees = [], boxes = [];
        const keys = {};

        function init() {
            resize();
            player.x = width / 2;
            player.y = height / 2;

            // Generate Map
            for(let i=0; i<15; i++) {
                trees.push({ x: Math.random()*width, y: Math.random()*height, r: 30 + Math.random()*20 });
            }
            for(let i=0; i<5; i++) {
                boxes.push({ x: Math.random()*width, y: Math.random()*height, w: 40, h: 40 });
            }

            window.addEventListener('resize', resize);
            window.addEventListener('keydown', e => keys[e.code] = true);
            window.addEventListener('keyup', e => keys[e.code] = false);
            window.addEventListener('mousemove', e => {
                player.angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
            });
            window.addEventListener('mousedown', shoot);

            loop();
        }

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        function shoot() {
            if(!isLanded) return;
            bullets.push({ 
                x: player.x + Math.cos(player.angle)*20, 
                y: player.y + Math.sin(player.angle)*20, 
                vx: Math.cos(player.angle)*10, 
                vy: Math.sin(player.angle)*10 
            });
        }

        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Drop Scale (Parachute effect)
            let scale = isLanded ? 1 : 1 + (altitude / 20);
            ctx.scale(scale, scale);

            if(!isLanded) {
                // Draw Parachute
                ctx.fillStyle = "rgba(211, 84, 0, 0.8)";
                ctx.beginPath();
                ctx.arc(0, -30, 40, Math.PI, 0);
                ctx.fill();
            }

            // Human Body (Top Down)
            ctx.rotate(player.angle);
            // Shoulders
            ctx.fillStyle = "#2c3e50";
            ctx.fillRect(-10, -15, 20, 30);
            // Head
            ctx.fillStyle = "#f39c12";
            ctx.beginPath(); ctx.arc(0, 0, 8, 0, Math.PI*2); ctx.fill();
            // Gun
            if(isLanded) {
                ctx.fillStyle = "#000";
                ctx.fillRect(10, 8, 25, 5);
            }
            
            ctx.restore();
        }

        function drawEnemy() {
            if(!isLanded) return;
            ctx.save();
            ctx.translate(enemy.x, enemy.y);
            ctx.rotate(enemy.angle);
            
            // Enemy Body
            ctx.fillStyle = "#c0392b";
            ctx.fillRect(-10, -15, 20, 30);
            ctx.fillStyle = "#111";
            ctx.beginPath(); ctx.arc(0, 0, 8, 0, Math.PI*2); ctx.fill();
            // Enemy Gun
            ctx.fillRect(10, 8, 20, 4);
            ctx.restore();
        }

        function updateAI() {
            if(!isLanded) return;
            let dx = player.x - enemy.x;
            let dy = player.y - enemy.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            enemy.angle = Math.atan2(dy, dx);

            // Chase logic
            let speed = player.hp < 40 ? 2.5 : 1.2;
            if(dist > 100) {
                enemy.x += Math.cos(enemy.angle) * speed;
                enemy.y += Math.sin(enemy.angle) * speed;
            }

            // Shoot
            if(dist < 400 && Math.random() < 0.02) {
                enemyBullets.push({ x: enemy.x, y: enemy.y, vx: Math.cos(enemy.angle)*7, vy: Math.sin(enemy.angle)*7 });
            }
        }

        function loop() {
            // Background
            ctx.fillStyle = "#3d4e3d";
            ctx.fillRect(0, 0, width, height);

            // Draw Map Elements
            trees.forEach(t => {
                ctx.fillStyle = "#1e3d1e";
                ctx.beginPath(); ctx.arc(t.x, t.y, t.r, 0, Math.PI*2); ctx.fill();
            });
            boxes.forEach(b => {
                ctx.fillStyle = "#5c4033";
                ctx.fillRect(b.x, b.y, b.w, b.h);
            });

            if(!isLanded) {
                altitude -= 0.5;
                document.getElementById('alt-val').innerText = Math.max(0, altitude).toFixed(0);
                if(altitude <= 0) {
                    isLanded = true;
                    document.getElementById('status').innerText = "STATUS: ENGAGED";
                }
                // Air Drift
                if(keys['KeyW']) player.y -= 3;
                if(keys['KeyS']) player.y += 3;
                if(keys['KeyA']) player.x -= 3;
                if(keys['KeyD']) player.x += 3;
            } else {
                // Move Player
                if(keys['KeyW']) player.y -= 3;
                if(keys['KeyS']) player.y += 3;
                if(keys['KeyA']) player.x -= 3;
                if(keys['KeyD']) player.x += 3;
                updateAI();
            }

            // Projectiles
            bullets.forEach((b, i) => {
                b.x += b.vx; b.y += b.vy;
                ctx.fillStyle = "#f1c40f";
                ctx.beginPath(); ctx.arc(b.x, b.y, 3, 0, Math.PI*2); ctx.fill();
                if(Math.hypot(b.x-enemy.x, b.y-enemy.y) < 20) {
                    enemy.hp -= 20; bullets.splice(i, 1);
                    if(enemy.hp <= 0) { enemy.x = -1000; } // Kill enemy
                }
            });

            enemyBullets.forEach((eb, i) => {
                eb.x += eb.vx; eb.y += eb.vy;
                ctx.fillStyle = "#e74c3c";
                ctx.beginPath(); ctx.arc(eb.x, eb.y, 3, 0, Math.PI*2); ctx.fill();
                if(Math.hypot(eb.x-player.x, eb.y-player.y) < 15) {
                    player.hp -= 10;
                    document.getElementById('hp-fill').style.width = player.hp + "%";
                    enemyBullets.splice(i, 1);
                    if(player.hp <= 0) location.reload();
                }
            });

            drawEnemy();
            drawPlayer();

            requestAnimationFrame(loop);
        }

        init();
    </script>
</body>
</html>
