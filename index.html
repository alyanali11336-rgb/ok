<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Frontline | Forest Checkpoint</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: 'Orbitron', sans-serif; }
        
        /* Realistic Tactical HUD */
        #hud {
            position: absolute; bottom: 30px; left: 30px; color: #00ff00;
            text-shadow: 0 0 5px #00ff00; pointer-events: none;
        }
        #hp-container {
            width: 250px; height: 10px; background: rgba(0, 50, 0, 0.5);
            border: 1px solid #00ff00; margin-top: 5px; position: relative;
        }
        #hp-bar { width: 100%; height: 100%; background: #00ff00; transition: width 0.2s; }
        
        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 20px; height: 20px;
            transform: translate(-50%, -50%); pointer-events: none;
        }
        #crosshair::before, #crosshair::after {
            content: ''; position: absolute; background: #00ff00;
        }
        #crosshair::before { top: 50%; width: 100%; height: 2px; } /* Horizontal */
        #crosshair::after { left: 50%; height: 100%; width: 2px; } /* Vertical */

        #hotbar {
            position: absolute; bottom: 20px; right: 30px; display: flex; gap: 10px;
        }
        .slot {
            width: 70px; height: 70px; border: 2px solid rgba(0,255,0,0.3);
            background: rgba(0,20,0,0.6); color: #00ff00;
            display: flex; align-items: center; justify-content: center; font-size: 12px;
        }
        .active { border: 2px solid #00ff00; box-shadow: 0 0 10px #00ff00; }

        #overlay { 
            position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; color: white;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="overlay">
        <h1>SECTOR 7: CHECKPOST</h1>
        <p>HOLD <span style="color:#00ff00">SHIFT</span> TO SPRINT | <span style="color:#00ff00">1-2</span> SWITCH GEAR</p>
        <button onclick="start()" style="padding: 10px 40px; background: #00ff00; border: none; cursor: pointer; font-weight: bold;">ENGAGE</button>
    </div>

    <div id="hud">
        <div style="font-size: 14px;">VITAL SIGNS: STABLE</div>
        <div id="hp-container"><div id="hp-bar"></div></div>
    </div>

    <div id="crosshair"></div>

    <div id="hotbar">
        <div id="slot-1" class="slot active">RIFLE</div>
        <div id="slot-2" class="slot">FLASHLIGHT</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- SCENE & LIGHTING ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x90caf9);
        scene.fog = new THREE.Fog(0x90caf9, 20, 100);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        const sun = new THREE.DirectionalLight(0xffffff, 1.5);
        sun.position.set(50, 50, 50);
        sun.castShadow = true;
        scene.add(sun, new THREE.AmbientLight(0xffffff, 0.5));

        // --- WORLD OBJECTS (Checkpost) ---
        const grass = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshStandardMaterial({ color: 0x3d5229 }));
        grass.rotation.x = -Math.PI / 2;
        grass.receiveShadow = true;
        scene.add(grass);

        // Function for Sandbag walls
        function createSandbag(x, z, ry) {
            const bag = new THREE.Mesh(new THREE.BoxGeometry(2, 0.5, 1), new THREE.MeshStandardMaterial({color: 0x968169}));
            bag.position.set(x, 0.25, z);
            bag.rotation.y = ry;
            scene.add(bag);
        }
        // Build a small checkpost square
        for(let i=0; i<3; i++) {
            createSandbag(-3, -5 + i, 0); 
            createSandbag(3, -5 + i, 0);
        }

        // Trees
        for(let i=0; i<50; i++) {
            const t = new THREE.Group();
            const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 5), new THREE.MeshStandardMaterial({color: 0x3d2b1f}));
            const leaves = new THREE.Mesh(new THREE.SphereGeometry(2), new THREE.MeshStandardMaterial({color: 0x1a2e1a}));
            leaves.position.y = 4;
            t.add(trunk, leaves);
            t.position.set((Math.random()-0.5)*150, 0, (Math.random()-0.5)*150);
            scene.add(t);
        }

        // --- ENEMIES (Soldiers) ---
        const enemies = [];
        function spawnSoldier() {
            const soldier = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 1.2), new THREE.MeshStandardMaterial({color: 0x2e3b23}));
            body.position.y = 1;
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshStandardMaterial({color: 0xd2b48c}));
            head.position.y = 1.9;
            soldier.add(body, head);
            soldier.position.set((Math.random()-0.5)*100, 0, (Math.random()-0.5)*100);
            scene.add(soldier);
            enemies.push(soldier);
        }
        for(let i=0; i<8; i++) spawnSoldier();

        // --- PLAYER WEAPON ---
        const gunParent = new THREE.Group();
        const gun = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.18, 1.2), new THREE.MeshStandardMaterial({color: 0x111111}));
        gun.position.set(0.4, -0.4, -0.8);
        gunParent.add(gun);
        camera.add(gunParent);
        scene.add(camera);

        // --- GAMEPLAY LOGIC ---
        let health = 100;
        let isSprinting = false;
        const controls = new PointerLockControls(camera, document.body);

        window.start = () => { controls.lock(); document.getElementById('overlay').style.display='none'; };

        document.addEventListener('keydown', (e) => {
            if(e.code === 'ShiftLeft') isSprinting = true;
            if(e.key === '1') { gun.visible = true; document.getElementById('slot-1').className='slot active'; document.getElementById('slot-2').className='slot'; }
            if(e.key === '2') { gun.visible = false; document.getElementById('slot-2').className='slot active'; document.getElementById('slot-1').className='slot'; }
        });
        document.addEventListener('keyup', (e) => { if(e.code === 'ShiftLeft') isSprinting = false; });

        window.addEventListener('mousedown', () => {
            if(!controls.isLocked || !gun.visible) return;
            gun.position.z += 0.1; // Kickback
            setTimeout(() => gun.position.z -= 0.1, 50);

            const ray = new THREE.Raycaster();
            ray.setFromCamera(new THREE.Vector2(0,0), camera);
            const hits = ray.intersectObjects(enemies, true);
            if(hits.length > 0) {
                let target = hits[0].object;
                while(target.parent !== scene) target = target.parent;
                scene.remove(target);
                enemies.splice(enemies.indexOf(target), 1);
            }
        });

        // --- ANIMATION ---
        const move = { f: false, b: false, l: false, r: false };
        document.onkeydown = (e) => { if(e.code==='KeyW') move.f=true; if(e.code==='KeyS') move.b=true; if(e.code==='KeyA') move.l=true; if(e.code==='KeyD') move.r=true; };
        document.onkeyup = (e) => { if(e.code==='KeyW') move.f=false; if(e.code==='KeyS') move.b=false; if(e.code==='KeyA') move.l=false; if(e.code==='KeyD') move.r=false; };

        function animate() {
            requestAnimationFrame(animate);
            if(controls.isLocked) {
                let speed = isSprinting ? 0.3 : 0.15;
                if(move.f) controls.moveForward(speed); if(move.b) controls.moveForward(-speed);
                if(move.l) controls.moveRight(-speed*0.8); if(move.r) controls.moveRight(speed*0.8);

                // Gun Sway
                const time = Date.now() * 0.005;
                if(move.f || move.b || move.l || move.r) {
                    gunParent.position.y = Math.sin(time) * 0.02;
                    gunParent.position.x = Math.cos(time * 0.5) * 0.02;
                }

                enemies.forEach(en => {
                    en.lookAt(camera.position.x, 0, camera.position.z);
                    const d = en.position.distanceTo(camera.position);
                    if(d < 30 && d > 2) en.translateZ(0.08);
                    if(d <= 2) {
                        health -= 0.5;
                        document.getElementById('hp-bar').style.width = health + "%";
                        if(health <= 0) location.reload();
                    }
                });
            }
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
