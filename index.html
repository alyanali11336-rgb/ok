<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VANGUARD: WARZONE OPS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #87CEEB; font-family: 'Rajdhani', sans-serif; }
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }
        
        /* UI & HUD */
        #ui-layer { position: absolute; z-index: 100; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; }
        .lobby-card { background: #000; padding: 50px; border: 2px solid #ff0000; text-align: center; box-shadow: 0 0 50px #ff0000; }
        h1 { font-family: 'Orbitron'; font-size: 3rem; color: #fff; margin: 0; }
        .btn-deploy { background: #ff0000; border: none; color: #fff; padding: 15px 50px; font-size: 1.5rem; cursor: pointer; margin-top: 20px; font-family: 'Orbitron'; }
        
        #hud { position: absolute; bottom: 30px; left: 30px; z-index: 50; display: none; color: #fff; }
        .hp-bar-bg { width: 300px; height: 20px; background: rgba(255,255,255,0.2); border: 2px solid #fff; }
        #hp-fill { width: 100%; height: 100%; background: #ff0000; transition: width 0.2s; }
        
        #damage-flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,0,0,0.3); display: none; pointer-events: none; z-index: 99; }
        #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid #fff; border-radius: 50%; transform: translate(-50%, -50%); z-index: 50; display: none; pointer-events: none; }
    </style>
</head>
<body>

    <div id="damage-flash"></div>
    <div id="crosshair"></div>
    
    <div id="hud">
        HEALTH
        <div class="hp-bar-bg"><div id="hp-fill"></div></div>
        <div id="status">STATUS: COMBAT ZONE</div>
    </div>

    <div id="ui-layer">
        <div class="lobby-card">
            <h1>WARZONE</h1>
            <p style="color: #ff0000;">ENEMIES ARE ARMED AND DANGEROUS</p>
            <button class="btn-deploy" id="play-button">DEPLOY</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>

    <script>
        let scene, camera, renderer, gun, clock;
        let isPlaying = false, health = 100;
        let player = { height: 1.8, velocityY: 0, isJumping: false };
        let bullets = [], enemyBullets = [], enemies = [], collidables = [];
        const keys = {};

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x90caef);
            scene.fog = new THREE.Fog(0x90caef, 20, 200);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.rotation.order = 'YXZ';

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            clock = new THREE.Clock();

            // Sunlight
            const sun = new THREE.DirectionalLight(0xffffff, 1.5);
            sun.position.set(50, 100, 50);
            sun.castShadow = true;
            scene.add(sun);
            scene.add(new THREE.AmbientLight(0xffffff, 0.4));

            createWarzone();
            createGun();

            document.getElementById('play-button').onclick = () => document.body.requestPointerLock();
            document.addEventListener('pointerlockchange', () => {
                isPlaying = document.pointerLockElement === document.body;
                document.getElementById('ui-layer').style.display = isPlaying ? 'none' : 'flex';
                document.getElementById('hud').style.display = isPlaying ? 'block' : 'none';
                document.getElementById('crosshair').style.display = isPlaying ? 'block' : 'none';
            });

            window.addEventListener('keydown', (e) => keys[e.code] = true);
            window.addEventListener('keyup', (e) => keys[e.code] = false);
            window.addEventListener('mousemove', (e) => {
                if(isPlaying) {
                    camera.rotation.y -= e.movementX * 0.002;
                    camera.rotation.x -= e.movementY * 0.002;
                    camera.rotation.x = Math.max(-1.5, Math.min(1.5, camera.rotation.x));
                }
            });
            window.addEventListener('mousedown', () => { if(isPlaying) shoot(); });

            animate();
        }

        function createGun() {
            gun = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.15, 0.8), new THREE.MeshStandardMaterial({color: 0x111111}));
            const barrel = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 0.6), new THREE.MeshStandardMaterial({color: 0x000000}));
            barrel.rotation.x = Math.PI/2; barrel.position.z = -0.5;
            gun.add(body, barrel);
            gun.position.set(0.3, -0.3, -0.6);
            camera.add(gun);
            scene.add(camera);
        }

        function createWarzone() {
            // Ground
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshStandardMaterial({color: 0x556644}));
            ground.rotation.x = -Math.PI/2; ground.receiveShadow = true;
            scene.add(ground);

            // Mountains
            for(let i=0; i<8; i++) {
                const mt = new THREE.Mesh(new THREE.ConeGeometry(40, 60, 4), new THREE.MeshStandardMaterial({color: 0x444444}));
                const angle = (i / 8) * Math.PI * 2;
                mt.position.set(Math.cos(angle)*150, 20, Math.sin(angle)*150);
                scene.add(mt);
                collidables.push(mt);
            }

            // Wooden Boxes (Warzone Cover)
            const boxGeo = new THREE.BoxGeometry(2, 2, 2);
            const boxMat = new THREE.MeshStandardMaterial({color: 0x8B4513});
            for(let i=0; i<40; i++) {
                const box = new THREE.Mesh(boxGeo, boxMat);
                box.position.set(Math.random()*100-50, 1, Math.random()*100-50);
                scene.add(box);
                collidables.push(box);
            }

            // Enemies (Shooting AI)
            for(let i=0; i<10; i++) {
                const en = new THREE.Mesh(new THREE.CapsuleGeometry(0.5, 1.5), new THREE.MeshStandardMaterial({color: 0xff0000}));
                en.position.set(Math.random()*80-40, 1.25, Math.random()*80-40);
                scene.add(en);
                enemies.push({mesh: en, lastShot: 0});
            }
        }

        function shoot() {
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: 0x00ffcc}));
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
            bullets.push({mesh: b, dir: dir});
            scene.add(b);
            gun.position.z += 0.1;
        }

        function takeDamage(amt) {
            health -= amt;
            document.getElementById('hp-fill').style.width = health + "%";
            document.getElementById('damage-flash').style.display = 'block';
            setTimeout(() => document.getElementById('damage-flash').style.display = 'none', 100);
            if(health <= 0) location.reload();
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isPlaying) return;

            const time = Date.now();
            const speed = 0.15;
            const oldPos = camera.position.clone();

            if(keys['KeyW']) camera.translateZ(-speed);
            if(keys['KeyS']) camera.translateZ(speed);
            if(keys['KeyA']) camera.translateX(-speed);
            if(keys['KeyD']) camera.translateX(speed);
            
            // Collision Detection
            for(let obj of collidables) {
                if(camera.position.distanceTo(obj.position) < 3) camera.position.copy(oldPos);
            }
            camera.position.y = player.height;

            // Gun animation
            gun.position.z += (-0.6 - gun.position.z) * 0.1;

            // Player Bullets
            bullets.forEach((b, i) => {
                b.mesh.position.add(b.dir.clone().multiplyScalar(2));
                enemies.forEach((en, ei) => {
                    if(b.mesh.position.distanceTo(en.mesh.position) < 1.5) {
                        scene.remove(en.mesh); enemies.splice(ei, 1);
                    }
                });
            });

            // Enemy AI (Shoot Back)
            enemies.forEach(en => {
                const dist = en.mesh.position.distanceTo(camera.position);
                en.mesh.lookAt(camera.position);
                
                if(dist < 40 && time - en.lastShot > 2000) {
                    const eb = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshBasicMaterial({color: 0xff0000}));
                    eb.position.copy(en.mesh.position);
                    const eDir = new THREE.Vector3().subVectors(camera.position, en.mesh.position).normalize();
                    enemyBullets.push({mesh: eb, dir: eDir});
                    scene.add(eb);
                    en.lastShot = time;
                }
            });

            // Enemy Bullet Physics
            enemyBullets.forEach((eb, i) => {
                eb.mesh.position.add(eb.dir.clone().multiplyScalar(0.8));
                if(eb.mesh.position.distanceTo(camera.position) < 1.5) {
                    takeDamage(10);
                    scene.remove(eb.mesh); enemyBullets.splice(i, 1);
                }
            });

            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>
