<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VANGUARD: ULTIMATE WARZONE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Rajdhani', sans-serif; }
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }
        
        /* UI & HUD */
        #ui-layer { position: absolute; z-index: 100; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; transition: 0.5s; }
        .lobby-card { background: #111; padding: 40px; border: 3px solid #00ffcc; text-align: center; box-shadow: 0 0 40px #00ffcc; }
        h1 { font-family: 'Orbitron'; font-size: 3.5rem; color: #fff; margin: 0; text-shadow: 0 0 20px #00ffcc; }
        .btn-deploy { background: #00ffcc; border: none; color: #000; padding: 15px 60px; font-size: 1.5rem; cursor: pointer; margin-top: 20px; font-family: 'Orbitron'; font-weight: bold; }
        
        #hud { position: absolute; bottom: 30px; left: 30px; z-index: 50; display: none; color: #fff; pointer-events: none; }
        .hp-bar { width: 250px; height: 15px; background: rgba(0,0,0,0.5); border: 2px solid #fff; margin-top: 5px; }
        #hp-fill { width: 100%; height: 100%; background: #00ffcc; transition: 0.3s; }
        
        #crosshair { position: fixed; top: 50%; left: 50%; width: 10px; height: 10px; border: 2px solid #00ffcc; border-radius: 50%; transform: translate(-50%, -50%); z-index: 50; display: none; pointer-events: none; }
        #damage-flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,0,0,0.4); display: none; pointer-events: none; z-index: 99; }
        #kill-feed { position: absolute; top: 20px; right: 20px; color: #00ffcc; font-family: 'Orbitron'; font-size: 1rem; text-align: right; }
    </style>
</head>
<body>

    <div id="damage-flash"></div>
    <div id="crosshair"></div>
    <div id="kill-feed"></div>
    
    <div id="hud">
        <div id="status" style="font-size: 0.8rem; letter-spacing: 2px;">VANGUARD OS v2.6</div>
        HEALTH
        <div class="hp-bar"><div id="hp-fill"></div></div>
        <div style="font-size: 0.8rem; margin-top: 5px;">[SHIFT] SPRINT | [C] CROUCH | [R-CLICK] AIM</div>
    </div>

    <div id="ui-layer">
        <div class="lobby-card">
            <h1>VANGUARD</h1>
            <p style="color: #00ffcc;">TRIPLE-A WARZONE SIMULATION</p>
            <button class="btn-deploy" id="play-button">DEPLOY NOW</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>

    <script>
        let scene, camera, renderer, gun, clock;
        let isPlaying = false, health = 100, isCrouching = false, isAiming = false;
        let player = { height: 1.8, vY: 0, isJumping: false, speed: 0.15 };
        let bullets = [], enemyBullets = [], enemies = [], collidables = [], medkits = [];
        const keys = {};

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.FogExp2(0x87CEEB, 0.015);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.rotation.order = 'YXZ';

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.toneMapping = THREE.ReinhardToneMapping;
            document.body.appendChild(renderer.domElement);

            clock = new THREE.Clock();

            const sun = new THREE.DirectionalLight(0xffffff, 2);
            sun.position.set(100, 200, 100);
            sun.castShadow = true;
            sun.shadow.mapSize.width = 2048;
            scene.add(sun);
            scene.add(new THREE.AmbientLight(0xffffff, 0.6));

            createWorld();
            createGun();

            document.getElementById('play-button').onclick = () => document.body.requestPointerLock();
            document.addEventListener('pointerlockchange', () => {
                isPlaying = document.pointerLockElement === document.body;
                document.getElementById('ui-layer').style.display = isPlaying ? 'none' : 'flex';
                document.getElementById('hud').style.display = isPlaying ? 'block' : 'none';
                document.getElementById('crosshair').style.display = isPlaying ? 'block' : 'none';
            });

            window.onkeydown = (e) => { keys[e.code] = true; if(e.code === 'KeyC') toggleCrouch(); };
            window.onkeyup = (e) => keys[e.code] = false;
            window.onmousemove = (e) => {
                if(isPlaying) {
                    let sens = isAiming ? 0.001 : 0.002;
                    camera.rotation.y -= e.movementX * sens;
                    camera.rotation.x -= e.movementY * sens;
                    camera.rotation.x = Math.max(-1.5, Math.min(1.5, camera.rotation.x));
                }
            };
            window.onmousedown = (e) => { 
                if(isPlaying && e.button === 0) shoot(); 
                if(isPlaying && e.button === 2) setAim(true);
            };
            window.onmouseup = (e) => { if(e.button === 2) setAim(false); };
            window.oncontextmenu = (e) => e.preventDefault();

            animate();
        }

        function createGun() {
            gun = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.18, 0.8), new THREE.MeshStandardMaterial({color: 0x111111}));
            const barrel = new THREE.Mesh(new THREE.CylinderGeometry(0.025, 0.025, 0.7), new THREE.MeshStandardMaterial({color: 0x000000}));
            barrel.rotation.x = Math.PI/2; barrel.position.z = -0.6;
            gun.add(body, barrel);
            gun.position.set(0.35, -0.3, -0.6);
            camera.add(gun);
            scene.add(camera);
        }

        function createWorld() {
            // High-Quality Grass
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(2000, 2000), new THREE.MeshStandardMaterial({color: 0x2d4c1e}));
            ground.rotation.x = -Math.PI/2; ground.receiveShadow = true;
            scene.add(ground);

            // House with Interior
            const house = new THREE.Group();
            const hWall = new THREE.MeshStandardMaterial({color: 0x666666});
            const buildWall = (w, h, d, x, y, z) => {
                const m = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), hWall);
                m.position.set(x, y, z); house.add(m); collidables.push(m);
            };
            buildWall(12, 6, 0.5, 0, 3, -6); // Back
            buildWall(0.5, 6, 12, -6, 3, 0); // Left
            buildWall(0.5, 6, 12, 6, 3, 0);  // Right
            buildWall(5, 6, 0.5, -3.5, 3, 6); buildWall(5, 6, 0.5, 3.5, 3, 6); // Front
            house.position.set(0, 0, -30);
            scene.add(house);

            // Warzone Terrain (Mountains)
            for(let i=0; i<12; i++) {
                const mt = new THREE.Mesh(new THREE.ConeGeometry(60, 100, 6), new THREE.MeshStandardMaterial({color: 0x333333}));
                const r = 250, a = (i/12)*Math.PI*2;
                mt.position.set(Math.cos(a)*r, 50, Math.sin(a)*r);
                scene.add(mt); collidables.push(mt);
            }

            // Forest & Boxes
            for(let i=0; i<100; i++) {
                const x = Math.random()*200-100, z = Math.random()*200-100;
                if(Math.abs(x) < 15 && Math.abs(z+30) < 15) continue;
                
                if(i % 2 === 0) { // Trees
                    const t = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.6, 10), new THREE.MeshStandardMaterial({color: 0x3d2b1f}));
                    t.position.set(x, 5, z); scene.add(t); collidables.push(t);
                } else { // Boxes
                    const b = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshStandardMaterial({color: 0x5c4033}));
                    b.position.set(x, 1, z); scene.add(b); collidables.push(b);
                }
            }

            // Medkits (Surprise feature)
            for(let i=0; i<5; i++) {
                const m = new THREE.Mesh(new THREE.BoxGeometry(1, 0.5, 1), new THREE.MeshStandardMaterial({color: 0x00ff00, emissive: 0x00ff00}));
                m.position.set(Math.random()*100-50, 0.25, Math.random()*100-50);
                scene.add(m); medkits.push(m);
            }

            // Enemies
            for(let i=0; i<15; i++) {
                const en = new THREE.Mesh(new THREE.CapsuleGeometry(0.5, 1.5), new THREE.MeshStandardMaterial({color: 0xff4444}));
                en.position.set(Math.random()*180-90, 1.25, Math.random()*180-90);
                scene.add(en); enemies.push({mesh: en, hp: 100, lastShot: 0});
            }
        }

        function toggleCrouch() {
            isCrouching = !isCrouching;
            player.height = isCrouching ? 1.0 : 1.8;
            player.speed = isCrouching ? 0.05 : (keys['ShiftLeft'] ? 0.25 : 0.15);
        }

        function setAim(val) {
            isAiming = val;
            camera.fov = val ? 40 : 75;
            camera.updateProjectionMatrix();
            gun.position.set(val ? 0 : 0.35, val ? -0.15 : -0.3, -0.4);
        }

        function shoot() {
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: 0x00ffcc}));
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
            bullets.push({mesh: b, dir: dir, time: Date.now()});
            scene.add(b);
            gun.position.z += 0.15;
        }

        function takeDamage(amt) {
            health -= amt;
            document.getElementById('hp-fill').style.width = health + "%";
            document.getElementById('damage-flash').style.display = 'block';
            setTimeout(() => document.getElementById('damage-flash').style.display = 'none', 100);
            if(health <= 0) location.reload();
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isPlaying) return;

            const time = Date.now();
            const oldPos = camera.position.clone();
            
            // Movement Logic
            let currentSpeed = keys['ShiftLeft'] && !isCrouching ? 0.25 : (isCrouching ? 0.07 : 0.15);
            if(keys['KeyW']) camera.translateZ(-currentSpeed);
            if(keys['KeyS']) camera.translateZ(currentSpeed);
            if(keys['KeyA']) camera.translateX(-currentSpeed);
            if(keys['KeyD']) camera.translateX(currentSpeed);

            // Barrier Collision
            for(let obj of collidables) {
                if(camera.position.distanceTo(obj.position) < 2.5) camera.position.copy(oldPos);
            }

            // Jump Gravity
            if(keys['Space'] && !player.isJumping && !isCrouching) { player.vY = 0.2; player.isJumping = true; }
            if(player.isJumping) {
                camera.position.y += player.vY; player.vY -= 0.01;
                if(camera.position.y <= player.height) { camera.position.y = player.height; player.isJumping = false; }
            } else { camera.position.y = player.height; }

            // Medkit Pickup
            medkits.forEach((m, i) => {
                if(camera.position.distanceTo(m.position) < 2) {
                    health = Math.min(100, health + 30);
                    document.getElementById('hp-fill').style.width = health + "%";
                    scene.remove(m); medkits.splice(i, 1);
                }
            });

            // Bullet Physics
            bullets.forEach((b, i) => {
                b.mesh.position.add(b.dir.clone().multiplyScalar(3));
                enemies.forEach((en, ei) => {
                    if(b.mesh.position.distanceTo(en.mesh.position) < 1.5) {
                        scene.remove(en.mesh); enemies.splice(ei, 1);
                        document.getElementById('kill-feed').innerHTML = "TARGET NEUTRALIZED<br>" + document.getElementById('kill-feed').innerHTML;
                    }
                });
                if(time - b.time > 2000) { scene.remove(b.mesh); bullets.splice(i, 1); }
            });

            // Enemy AI
            enemies.forEach(en => {
                en.mesh.lookAt(camera.position);
                if(en.mesh.position.distanceTo(camera.position) < 60 && time - en.lastShot > 1500) {
                    const eb = new THREE.Mesh(new THREE.SphereGeometry(0.15), new THREE.MeshBasicMaterial({color: 0xff0000}));
                    eb.position.copy(en.mesh.position);
                    const eDir = new THREE.Vector3().subVectors(camera.position, en.mesh.position).normalize();
                    enemyBullets.push({mesh: eb, dir: eDir});
                    scene.add(eb);
                    en.lastShot = time;
                }
            });

            enemyBullets.forEach((eb, i) => {
                eb.mesh.position.add(eb.dir.clone().multiplyScalar(0.7));
                if(eb.mesh.position.distanceTo(camera.position) < 1.5) {
                    takeDamage(10);
                    scene.remove(eb.mesh); enemyBullets.splice(i, 1);
                }
            });

            // Gun Sway & ADS Return
            gun.position.z += ( (isAiming ? -0.4 : -0.6) - gun.position.z) * 0.1;

            renderer.render(scene, camera);
        }
        window.onload = init;
    </script>
</body>
</html>
