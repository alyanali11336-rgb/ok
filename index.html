<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Frontline | Night Forest</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; }
        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 10px; height: 10px;
            border: 1px solid rgba(255, 255, 255, 0.5); transform: translate(-50%, -50%);
            pointer-events: none;
        }
        #ui { position: absolute; bottom: 20px; left: 20px; color: #00ff00; }
        #instructions { 
            position: absolute; width: 100%; height: 100%; background: #000; 
            display: flex; flex-direction: column; justify-content: center; 
            align-items: center; color: #00ff00; z-index: 10; text-align: center;
        }
        button { background: transparent; color: #00ff00; border: 1px solid #00ff00; padding: 10px 20px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="instructions">
        <h1>NIGHT FOREST PROTOCOL</h1>
        <p>FLASHLIGHT: ACTIVE | WEAPON: READY</p>
        <button onclick="this.parentElement.style.display='none'">START MISSION</button>
    </div>

    <div id="crosshair"></div>
    <div id="ui">NVG STATUS: ONLINE | SECTOR: FOREST</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- 1. DARK SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000205);
        scene.fog = new THREE.Fog(0x000000, 1, 30); // Very thick fog for darkness

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- 2. THE TORCH (SpotLight) ---
        const flashlight = new THREE.SpotLight(0xffffff, 50);
        flashlight.angle = Math.PI / 6; // Beam width
        flashlight.penumbra = 0.3; // Soft edges
        flashlight.decay = 2;
        flashlight.distance = 40;
        flashlight.castShadow = true;

        // Attach flashlight to camera
        camera.add(flashlight);
        camera.add(flashlight.target);
        flashlight.target.position.set(0, 0, -1); // Points forward
        
        // Slight moonlight so it's not 100% pitch black
        const moon = new THREE.AmbientLight(0x0a0a1a, 0.2);
        scene.add(moon);

        // --- 3. THE FOREST ---
        // Ground
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(200, 200),
            new THREE.MeshStandardMaterial({ color: 0x050505 })
        );
        ground.rotation.x = -Math.PI/2;
        scene.add(ground);

        // Procedural Trees
        function createTree(x, z) {
            const tree = new THREE.Group();
            const trunk = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.3, 4),
                new THREE.MeshStandardMaterial({ color: 0x1a0a00 })
            );
            trunk.position.y = 2;
            
            const leaves = new THREE.Mesh(
                new THREE.ConeGeometry(1.5, 4, 6),
                new THREE.MeshStandardMaterial({ color: 0x051a05 })
            );
            leaves.position.y = 5;
            
            tree.add(trunk, leaves);
            tree.position.set(x, 0, z);
            scene.add(tree);
        }

        for(let i=0; i<150; i++) {
            createTree((Math.random()-0.5)*100, (Math.random()-0.5)*100);
        }

        // --- 4. THE ENEMIES (Stalkers) ---
        const enemies = [];
        function spawnEnemy() {
            const enemy = new THREE.Mesh(
                new THREE.CapsuleGeometry(0.4, 0.8),
                new THREE.MeshStandardMaterial({ color: 0x000000 }) // Black suits for stealth
            );
            enemy.position.set((Math.random()-0.5)*40, 0.8, (Math.random()-0.5)*40);
            scene.add(enemy);
            enemies.push(enemy);
        }
        for(let i=0; i<10; i++) spawnEnemy();

        // --- 5. GUN & CONTROLS ---
        const gun = new THREE.Mesh(
            new THREE.BoxGeometry(0.1, 0.15, 0.7),
            new THREE.MeshStandardMaterial({ color: 0x111111 })
        );
        gun.position.set(0.3, -0.3, -0.5);
        camera.add(gun);
        scene.add(camera);

        const controls = new PointerLockControls(camera, document.body);
        document.body.addEventListener('click', () => controls.lock());

        // --- 6. SHOOTING ---
        const raycaster = new THREE.Raycaster();
        window.addEventListener('mousedown', () => {
            if(!controls.isLocked) return;
            
            // Recoil
            gun.position.z += 0.05;
            setTimeout(() => gun.position.z -= 0.05, 50);

            raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
            const hits = raycaster.intersectObjects(enemies);
            if(hits.length > 0) {
                scene.remove(hits[0].object);
                console.log("Stalker eliminated");
            }
        });

        // --- 7. MOVEMENT & ANIMATION ---
        let moveF = false, moveB = false, moveL = false, moveR = false;
        document.onkeydown = (e) => {
            if(e.code === 'KeyW') moveF = true;
            if(e.code === 'KeyS') moveB = true;
            if(e.code === 'KeyA') moveL = true;
            if(e.code === 'KeyD') moveR = true;
        };
        document.onkeyup = (e) => {
            if(e.code === 'KeyW') moveF = false;
            if(e.code === 'KeyS') moveB = false;
            if(e.code === 'KeyA') moveL = false;
            if(e.code === 'KeyD') moveR = false;
        };

        const velocity = new THREE.Vector3();
        let prevTime = performance.now();

        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now();
            const delta = (time - prevTime) / 1000;

            if(controls.isLocked) {
                velocity.z -= velocity.z * 10 * delta;
                velocity.x -= velocity.x * 10 * delta;
                if(moveF) velocity.z -= 150 * delta;
                if(moveB) velocity.z += 150 * delta;
                if(moveL) velocity.x -= 150 * delta;
                if(moveR) velocity.x += 150 * delta;
                controls.moveForward(-velocity.z * delta);
                controls.moveRight(-velocity.x * delta);
            }
            
            prevTime = time;
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
